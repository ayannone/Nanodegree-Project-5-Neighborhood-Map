
<!--
This example is a proof of concept, for how to use the Yelp v2 API with javascript.
You wouldn't actually want to expose your access token secret like this in a real application.
-->
<!DOCTYPE html>
<html>
<head>
<title>Yelp OAuth Example</title>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
<script type="text/javascript" src="http://oauth.googlecode.com/svn/code/javascript/oauth.js"></script>
<script type="text/javascript" src="http://oauth.googlecode.com/svn/code/javascript/sha1.js"></script>

<script type="text/javascript">
var auth = {
  //
  // Update with your auth tokens.
  //
  consumerKey: "6elNSWaVZM9nC76VherCWA",
  consumerSecret: "HfSD_E8RG-FGJb6Z2zJJdsCnYXo",
  accessToken: "sYRyIBg8DOU7iID93eLUhLtEjS8J1WpJ",
  // This example is a proof of concept, for how to use the Yelp v2 API with javascript.
  // You wouldn't actually want to expose your access token secret like this in a real application.
  accessTokenSecret: "y4h0hIdiBdFZ2RsL4AWKpUFm2ak",
  serviceProvider: {
    signatureMethod: "HMAC-SHA1"
  }
};
var terms = 'food';
var near = 'New+York+City'; //'San+Francisco';
var accessor = {
  consumerSecret: auth.consumerSecret,
  tokenSecret: auth.accessTokenSecret
};

// http://api.yelp.com/v2/search
// ?limit=20
// &location=Berlin -- OK
// &oauth_consumer_key=qHsEZDzSkqfT8aOxr79Isw -- OK
// &oauth_nonce=60b30afc5087fcc509eb4245d1e9410c -- OK
// &oauth_signature=XFZFpzdg36G0eG42TZKy5Ny9BbU%3D -- OK
// &oauth_signature_method=HMAC-SHA1 -- OK
// &oauth_timestamp=1406153682 -- OK
// &oauth_token=kqq8iu-whGeYubw3Q8o_fNyzUgDEpnrO -- OK
// &oauth_version=1.0
// &term=bar -- OK

parameters = [];
parameters.push(['term', terms]);
parameters.push(['location', near]);
parameters.push(['callback', 'cb']);
parameters.push(['oauth_consumer_key', auth.consumerKey]);
parameters.push(['oauth_token', auth.accessToken]);
parameters.push(['oauth_signature_method', 'HMAC-SHA1']);

var message = {
  'action': 'https://api.yelp.com/v2/search',
  'method': 'GET',
  'parameters': parameters
};

OAuth.setTimestampAndNonce(message);
OAuth.SignatureMethod.sign(message, accessor);
var parameterMap = OAuth.getParameterMap(message.parameters);
parameterMap.oauth_signature = OAuth.percentEncode(parameterMap.oauth_signature)
console.log(parameterMap);

$.ajax({
  url: message.action,
  data: parameterMap,
  cache: true,
  dataType: 'jsonp',
  jsonpCallback: 'cb',
  success: function(data) {
    console.log(data);
    $.each(data.businesses,function(i,business){
      var yelp_info = "";
      yelp_info  = "<img src=\""+ business.image_url + "\"><br>";
      yelp_info += "Name:" + business.name + "<br>";
      yelp_info += "Rating: " + business.rating + "<br>";
      yelp_info += "<img src=\""+ business.rating_img_url + "\"><br>";
      yelp_info += "Reviews: " + business.review_count + "<br>";
      yelp_info += "Address: " + business.location.display_address + "<br>";
      yelp_info += "<a href=\"" + business.url + "\">read more</a><br>";
      yelp_info += "<br>";
      $("body").append(yelp_info);
    });
  }
});
</script>
</head>
<body>
</body>
</html>